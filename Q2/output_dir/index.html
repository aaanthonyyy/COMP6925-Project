<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        const scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          const element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          const newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((_entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>notebook</title>
    <script type="module" crossorigin src="./assets/index-3OIHLLq_.js"></script>
    <link rel="modulepreload" crossorigin href="./assets/preload-helper-g1IWzEZ-.js">
    <link rel="modulepreload" crossorigin href="./assets/chunk-LvLJmgfZ.js">
    <link rel="modulepreload" crossorigin href="./assets/react-XTZdWHwa.js">
    <link rel="modulepreload" crossorigin href="./assets/compiler-runtime-QczY1yfQ.js">
    <link rel="modulepreload" crossorigin href="./assets/useEventListener-4mpeqPxW.js">
    <link rel="modulepreload" crossorigin href="./assets/react-dom-BZDtXk6t.js">
    <link rel="modulepreload" crossorigin href="./assets/jsx-runtime-DUsrKwmN.js">
    <link rel="modulepreload" crossorigin href="./assets/Combination-D2HqSOvH.js">
    <link rel="modulepreload" crossorigin href="./assets/clsx-FpJB9huX.js">
    <link rel="modulepreload" crossorigin href="./assets/cn-Cs2e4A8T.js">
    <link rel="modulepreload" crossorigin href="./assets/menu-items-B57SjdWM.js">
    <link rel="modulepreload" crossorigin href="./assets/hotkeys-Dh4gy4JD.js">
    <link rel="modulepreload" crossorigin href="./assets/button-D8mnDDLX.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-Dj-O1Spr.js">
    <link rel="modulepreload" crossorigin href="./assets/createLucideIcon-BJ2I6csQ.js">
    <link rel="modulepreload" crossorigin href="./assets/check-CWbw3kKW.js">
    <link rel="modulepreload" crossorigin href="./assets/select-CgZgQ5hV.js">
    <link rel="modulepreload" crossorigin href="./assets/multi-map-D3NvLiI9.js">
    <link rel="modulepreload" crossorigin href="./assets/chevron-right-B_qBg_RU.js">
    <link rel="modulepreload" crossorigin href="./assets/dropdown-menu-Ciqx4yT-.js">
    <link rel="modulepreload" crossorigin href="./assets/tooltip-DqNvr2Rw.js">
    <link rel="modulepreload" crossorigin href="./assets/_Uint8Array-BGESiCQL.js">
    <link rel="modulepreload" crossorigin href="./assets/_getTag-BWqNuuwU.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseIsEqual-C8v2yRqO.js">
    <link rel="modulepreload" crossorigin href="./assets/jotai-D74Ef_p1.js">
    <link rel="modulepreload" crossorigin href="./assets/invariant-Amh6wt4N.js">
    <link rel="modulepreload" crossorigin href="./assets/isArrayLikeObject-BkJc8lDE.js">
    <link rel="modulepreload" crossorigin href="./assets/merge-5YNOh9ZD.js">
    <link rel="modulepreload" crossorigin href="./assets/zod-BBqism5D.js">
    <link rel="modulepreload" crossorigin href="./assets/utils-x9KlwLm7.js">
    <link rel="modulepreload" crossorigin href="./assets/requests-THIDPq-F.js">
    <link rel="modulepreload" crossorigin href="./assets/once-BxRirs3K.js">
    <link rel="modulepreload" crossorigin href="./assets/toDate-Y5T6FHPx.js">
    <link rel="modulepreload" crossorigin href="./assets/isSymbol-BGkTcW3U.js">
    <link rel="modulepreload" crossorigin href="./assets/toString-DlRqgfqz.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseSlice-BoaxdS7L.js">
    <link rel="modulepreload" crossorigin href="./assets/_hasUnicode-CNlKPr15.js">
    <link rel="modulepreload" crossorigin href="./assets/useLifecycle-8fgb5Nue.js">
    <link rel="modulepreload" crossorigin href="./assets/capitalize-L9-XHPtm.js">
    <link rel="modulepreload" crossorigin href="./assets/ai-model-dropdown-CO52rzQt.js">
    <link rel="modulepreload" crossorigin href="./assets/badge-Cm0WUI-_.js">
    <link rel="modulepreload" crossorigin href="./assets/use-toast-DKTyV2AR.js">
    <link rel="modulepreload" crossorigin href="./assets/constants-BmIIVBf_.js">
    <link rel="modulepreload" crossorigin href="./assets/Deferred-9HYzcD3r.js">
    <link rel="modulepreload" crossorigin href="./assets/config-CbG7e0K6.js">
    <link rel="modulepreload" crossorigin href="./assets/uuid-B8w6pjWV.js">
    <link rel="modulepreload" crossorigin href="./assets/DeferredRequestRegistry-DfLQSvoS.js">
    <link rel="modulepreload" crossorigin href="./assets/connection-B11rCPnY.js">
    <link rel="modulepreload" crossorigin href="./assets/useNonce-D8CLFIrY.js">
    <link rel="modulepreload" crossorigin href="./assets/capabilities-Bdlrhekp.js">
    <link rel="modulepreload" crossorigin href="./assets/createReducer-VgoBNe3M.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-C3a_7WFa.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-0z0sEYV-.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-BzfTz_Dx.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-DmruaXMM.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-DU0YrNRK.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-_bGPtAsk.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-DsSBESho.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-B2TjmP7E.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-BzDb7E9f.js">
    <link rel="modulepreload" crossorigin href="./assets/stex-C4ZxI0N3.js">
    <link rel="modulepreload" crossorigin href="./assets/cjs-Ba5CQnxe.js">
    <link rel="modulepreload" crossorigin href="./assets/_arrayReduce-DdxhySYh.js">
    <link rel="modulepreload" crossorigin href="./assets/type-kFt-n-jZ.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseProperty-D0ckTA0L.js">
    <link rel="modulepreload" crossorigin href="./assets/toNumber-GB_lFVaq.js">
    <link rel="modulepreload" crossorigin href="./assets/now-CAWn5i9V.js">
    <link rel="modulepreload" crossorigin href="./assets/debounce-Bgq-wc7M.js">
    <link rel="modulepreload" crossorigin href="./assets/toInteger-Cl1doThW.js">
    <link rel="modulepreload" crossorigin href="./assets/main-CC_mbgxK.js">
    <link rel="modulepreload" crossorigin href="./assets/cells-DoKM12vd.js">
    <link rel="modulepreload" crossorigin href="./assets/kbd-EdFdwHEs.js">
    <link rel="modulepreload" crossorigin href="./assets/renderShortcut-CLenKJO6.js">
    <link rel="modulepreload" crossorigin href="./assets/useEvent-l9BzRqpK.js">
    <link rel="modulepreload" crossorigin href="./assets/useDeleteCell-BDBSmjLV.js">
    <link rel="modulepreload" crossorigin href="./assets/lazy-Cbg8zRvU.js">
    <link rel="modulepreload" crossorigin href="./assets/defaultLocale-8c1ixjJ_.js">
    <link rel="modulepreload" crossorigin href="./assets/precisionRound-CQhbsDNz.js">
    <link rel="modulepreload" crossorigin href="./assets/defaultLocale-BECdiY5x.js">
    <link rel="modulepreload" crossorigin href="./assets/vega-loader.browser-DZ31-605.js">
    <link rel="modulepreload" crossorigin href="./assets/tooltip-CSAGVmjx.js">
    <link rel="modulepreload" crossorigin href="./assets/ErrorBoundary-6EjkHrSV.js">
    <link rel="modulepreload" crossorigin href="./assets/alert-dialog-D9SwG8oA.js">
    <link rel="modulepreload" crossorigin href="./assets/dialog-BPIq0Dmw.js">
    <link rel="modulepreload" crossorigin href="./assets/useDebounce-C9S6xmGh.js">
    <link rel="modulepreload" crossorigin href="./assets/numbers-BigybruE.js">
    <link rel="modulepreload" crossorigin href="./assets/SSRProvider-DlZbKHsu.js">
    <link rel="modulepreload" crossorigin href="./assets/context-CO64Gasq.js">
    <link rel="modulepreload" crossorigin href="./assets/useNumberFormatter-B5HAJDUq.js">
    <link rel="modulepreload" crossorigin href="./assets/usePress-DHxqjtDm.js">
    <link rel="modulepreload" crossorigin href="./assets/input-CVoLDDk-.js">
    <link rel="modulepreload" crossorigin href="./assets/ImperativeModal-ameyIrhc.js">
    <link rel="modulepreload" crossorigin href="./assets/cell-link-BiAu_8pk.js">
    <link rel="modulepreload" crossorigin href="./assets/alert-D5BMn3Et.js">
    <link rel="modulepreload" crossorigin href="./assets/links-Iv0WhyKW.js">
    <link rel="modulepreload" crossorigin href="./assets/state-i7G4J1VS.js">
    <link rel="modulepreload" crossorigin href="./assets/MarimoErrorOutput-Bh7Bgl2Z.js">
    <link rel="modulepreload" crossorigin href="./assets/copy-BS3uwoaq.js">
    <link rel="modulepreload" crossorigin href="./assets/copy-DhmkXAPp.js">
    <link rel="modulepreload" crossorigin href="./assets/copy-icon-Lyk2_Z8G.js">
    <link rel="modulepreload" crossorigin href="./assets/spinner-DpaQpaiI.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-D1pae9A2.js">
    <link rel="modulepreload" crossorigin href="./assets/focus-CyxSol0W.js">
    <link rel="modulepreload" crossorigin href="./assets/popover-DZBXSGEz.js">
    <link rel="modulepreload" crossorigin href="./assets/useRunCells-DT1En-Te.js">
    <link rel="modulepreload" crossorigin href="./assets/mode-DKDAYLK9.js">
    <link rel="modulepreload" crossorigin href="./assets/purify.es-hXMlfS4W.js">
    <link rel="modulepreload" crossorigin href="./assets/RenderHTML-Dlz0Ew2i.js">
    <link rel="modulepreload" crossorigin href="./assets/table-CesNYRF-.js">
    <link rel="modulepreload" crossorigin href="./assets/tabs-BjAbB8w_.js">
    <link rel="modulepreload" crossorigin href="./assets/add-missing-import-DV1FOw9w.js">
    <link rel="modulepreload" crossorigin href="./assets/useAsyncData-_-DLduEH.js">
    <link rel="modulepreload" crossorigin href="./assets/useIframeCapabilities-r0LQMxAQ.js">
    <link rel="modulepreload" crossorigin href="./assets/LazyAnyLanguageCodeMirror-C7KtNlRp.js">
    <link rel="modulepreload" crossorigin href="./assets/error-banner-C9tkg1MX.js">
    <link rel="modulepreload" crossorigin href="./assets/formats-C3exma5i.js">
    <link rel="modulepreload" crossorigin href="./assets/useTheme-DpA-8Qyy.js">
    <link rel="modulepreload" crossorigin href="./assets/en-US-Lc4gASCJ.js">
    <link rel="modulepreload" crossorigin href="./assets/isValid-Cd_L_2Pm.js">
    <link rel="modulepreload" crossorigin href="./assets/maps-D4abje2p.js">
    <link rel="modulepreload" crossorigin href="./assets/shim-D-ElLTBO.js">
    <link rel="modulepreload" crossorigin href="./assets/download-CCvBQ7qL.js">
    <link rel="modulepreload" crossorigin href="./assets/extends-C2lJEiP_.js">
    <link rel="modulepreload" crossorigin href="./assets/emotion-is-prop-valid.esm-c4A1huxA.js">
    <link rel="modulepreload" crossorigin href="./assets/useDateFormatter-BMdQ9MI_.js">
    <link rel="modulepreload" crossorigin href="./assets/katex-BmfUoCWW.js">
    <link rel="modulepreload" crossorigin href="./assets/marked.esm-idL59iHw.js">
    <link rel="modulepreload" crossorigin href="./assets/chunk-T7OEMACY-CdGEwedE.js">
    <link rel="modulepreload" crossorigin href="./assets/range-Bbli-TEL.js">
    <link rel="modulepreload" crossorigin href="./assets/table-kHJ0xpFt.js">
    <link rel="modulepreload" crossorigin href="./assets/Output-DxdWGPFi.js">
    <link rel="modulepreload" crossorigin href="./assets/name-cell-input-C6ZYU6mN.js">
    <link rel="modulepreload" crossorigin href="./assets/useHotkey-B0ylhc2m.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-CqHWOZu2.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-BcLYYUSi.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-BVXr6b5T.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-BrEX5EQl.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-CalRK9ms.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-Cc4T7UUX.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-D3MC5WiF.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-DgaCIZAa.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-rqHtY98i.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-tj-jaP-y.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-w7c0BKrD.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-CCZcRJI9.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-CrDb6akR.js">
    <link rel="modulepreload" crossorigin href="./assets/apl-BQt6lLuE.js">
    <link rel="modulepreload" crossorigin href="./assets/asciiarmor-BjX7bs0j.js">
    <link rel="modulepreload" crossorigin href="./assets/asn1-xn1MtyoW.js">
    <link rel="modulepreload" crossorigin href="./assets/brainfuck-BjO-UY1i.js">
    <link rel="modulepreload" crossorigin href="./assets/clike-DW9tQWfF.js">
    <link rel="modulepreload" crossorigin href="./assets/clojure-BSW96HRx.js">
    <link rel="modulepreload" crossorigin href="./assets/cmake-C7UlMfz3.js">
    <link rel="modulepreload" crossorigin href="./assets/cobol-CyWIev3Y.js">
    <link rel="modulepreload" crossorigin href="./assets/coffeescript-DTvziYTK.js">
    <link rel="modulepreload" crossorigin href="./assets/commonlisp-yMdkdGMi.js">
    <link rel="modulepreload" crossorigin href="./assets/crystal-BGnoSp3z.js">
    <link rel="modulepreload" crossorigin href="./assets/css-D7fWzevp.js">
    <link rel="modulepreload" crossorigin href="./assets/cypher-Cr1dl0Qf.js">
    <link rel="modulepreload" crossorigin href="./assets/d-C2bS5bA6.js">
    <link rel="modulepreload" crossorigin href="./assets/diff-B2mHQyn6.js">
    <link rel="modulepreload" crossorigin href="./assets/dtd-Cy-lUE7p.js">
    <link rel="modulepreload" crossorigin href="./assets/dylan-mm60grwk.js">
    <link rel="modulepreload" crossorigin href="./assets/ecl-Cqi05Wy1.js">
    <link rel="modulepreload" crossorigin href="./assets/eiffel-FkvfLQq7.js">
    <link rel="modulepreload" crossorigin href="./assets/elm-Da5txHw0.js">
    <link rel="modulepreload" crossorigin href="./assets/erlang-CdnCEH5x.js">
    <link rel="modulepreload" crossorigin href="./assets/simple-mode-B185hCuE.js">
    <link rel="modulepreload" crossorigin href="./assets/factor-CamlR8EJ.js">
    <link rel="modulepreload" crossorigin href="./assets/forth-UcMX0m31.js">
    <link rel="modulepreload" crossorigin href="./assets/fortran-DZ_vNVsP.js">
    <link rel="modulepreload" crossorigin href="./assets/gas-CM88o6Zj.js">
    <link rel="modulepreload" crossorigin href="./assets/gherkin-BhrpTeN9.js">
    <link rel="modulepreload" crossorigin href="./assets/groovy-BFju68Wx.js">
    <link rel="modulepreload" crossorigin href="./assets/haskell-CrWHY4et.js">
    <link rel="modulepreload" crossorigin href="./assets/haxe-1eKW-tbO.js">
    <link rel="modulepreload" crossorigin href="./assets/idl-Do4AwvU2.js">
    <link rel="modulepreload" crossorigin href="./assets/javascript-CTXZKRYd.js">
    <link rel="modulepreload" crossorigin href="./assets/julia-BRynwHI4.js">
    <link rel="modulepreload" crossorigin href="./assets/livescript-ZmIBNA-I.js">
    <link rel="modulepreload" crossorigin href="./assets/lua-mUfZ-MRC.js">
    <link rel="modulepreload" crossorigin href="./assets/mathematica-Dil5dTHO.js">
    <link rel="modulepreload" crossorigin href="./assets/mbox-Dnkn9wSr.js">
    <link rel="modulepreload" crossorigin href="./assets/mirc-auEWieOB.js">
    <link rel="modulepreload" crossorigin href="./assets/mllike-xVJsauJ8.js">
    <link rel="modulepreload" crossorigin href="./assets/modelica-B8kajVDm.js">
    <link rel="modulepreload" crossorigin href="./assets/mscgen-Bsnta1jn.js">
    <link rel="modulepreload" crossorigin href="./assets/mumps-CMw16b5q.js">
    <link rel="modulepreload" crossorigin href="./assets/nsis-DwPdi8sw.js">
    <link rel="modulepreload" crossorigin href="./assets/ntriples-O5lQxirn.js">
    <link rel="modulepreload" crossorigin href="./assets/octave-CMfAar-E.js">
    <link rel="modulepreload" crossorigin href="./assets/oz-CLRI9Qww.js">
    <link rel="modulepreload" crossorigin href="./assets/pascal-D2M_3HBx.js">
    <link rel="modulepreload" crossorigin href="./assets/perl-B8lV7aKt.js">
    <link rel="modulepreload" crossorigin href="./assets/pig-Bima2bfE.js">
    <link rel="modulepreload" crossorigin href="./assets/powershell-v_t41ydu.js">
    <link rel="modulepreload" crossorigin href="./assets/properties-ChrStSby.js">
    <link rel="modulepreload" crossorigin href="./assets/protobuf-Bin6kmlf.js">
    <link rel="modulepreload" crossorigin href="./assets/pug-UWVdYLYW.js">
    <link rel="modulepreload" crossorigin href="./assets/puppet-DYrtWvYn.js">
    <link rel="modulepreload" crossorigin href="./assets/python-BuKrulde.js">
    <link rel="modulepreload" crossorigin href="./assets/q-CrXUTiVN.js">
    <link rel="modulepreload" crossorigin href="./assets/r-Bk2Tiso2.js">
    <link rel="modulepreload" crossorigin href="./assets/rpm-CmmZphz3.js">
    <link rel="modulepreload" crossorigin href="./assets/ruby-ElyOTVeQ.js">
    <link rel="modulepreload" crossorigin href="./assets/sas-jE3ZlG0K.js">
    <link rel="modulepreload" crossorigin href="./assets/scheme-CZF1tRbv.js">
    <link rel="modulepreload" crossorigin href="./assets/shell-LqT3ZqMa.js">
    <link rel="modulepreload" crossorigin href="./assets/sieve-y15yT7Pp.js">
    <link rel="modulepreload" crossorigin href="./assets/smalltalk-pk5PvsMs.js">
    <link rel="modulepreload" crossorigin href="./assets/sparql-DTZ_gfPQ.js">
    <link rel="modulepreload" crossorigin href="./assets/stylus-CrGj0eNT.js">
    <link rel="modulepreload" crossorigin href="./assets/swift-tt3PlBbI.js">
    <link rel="modulepreload" crossorigin href="./assets/tcl-1P4b0GMJ.js">
    <link rel="modulepreload" crossorigin href="./assets/textile-BHDIuMYh.js">
    <link rel="modulepreload" crossorigin href="./assets/toml-C8qoqk_i.js">
    <link rel="modulepreload" crossorigin href="./assets/troff-DMiF5Zmz.js">
    <link rel="modulepreload" crossorigin href="./assets/ttcn-cfg-qLZtNU-E.js">
    <link rel="modulepreload" crossorigin href="./assets/ttcn-BAUp3RZn.js">
    <link rel="modulepreload" crossorigin href="./assets/turtle-BizIwmKv.js">
    <link rel="modulepreload" crossorigin href="./assets/vb-Bn_uCxNL.js">
    <link rel="modulepreload" crossorigin href="./assets/vbscript-BTKW8Atx.js">
    <link rel="modulepreload" crossorigin href="./assets/velocity-CcB05fpi.js">
    <link rel="modulepreload" crossorigin href="./assets/verilog-BWdtOJH8.js">
    <link rel="modulepreload" crossorigin href="./assets/vhdl-CzFOaOHx.js">
    <link rel="modulepreload" crossorigin href="./assets/webidl-DDEKCqSy.js">
    <link rel="modulepreload" crossorigin href="./assets/xquery-BcF6ZhQP.js">
    <link rel="modulepreload" crossorigin href="./assets/yacas-BARQAiXa.js">
    <link rel="modulepreload" crossorigin href="./assets/z80-DO_Ep0iT.js">
    <link rel="modulepreload" crossorigin href="./assets/esm-DnNh7vdQ.js">
    <link rel="modulepreload" crossorigin href="./assets/objectWithoutPropertiesLoose-DDabolgJ.js">
    <link rel="modulepreload" crossorigin href="./assets/esm-Crqxhl3F.js">
    <link rel="modulepreload" crossorigin href="./assets/trash-Df8Wb7xS.js">
    <link rel="modulepreload" crossorigin href="./assets/ConsoleOutput-D8ETq-cc.js">
    <link rel="modulepreload" crossorigin href="./assets/icons-BgmgMjOV.js">
    <link rel="modulepreload" crossorigin href="./assets/blob-LiDbeYko.js">
    <link rel="modulepreload" crossorigin href="./assets/add-cell-with-ai-85tnyxYo.js">
    <link rel="modulepreload" crossorigin href="./assets/chart-no-axes-column-BrQ3B3xc.js">
    <link rel="modulepreload" crossorigin href="./assets/square-function-D5EEjILG.js">
    <link rel="modulepreload" crossorigin href="./assets/spec-DpllSlJD.js">
    <link rel="modulepreload" crossorigin href="./assets/useInstallPackage-BaAhpZlP.js">
    <link rel="modulepreload" crossorigin href="./assets/column-preview-DGBk0umL.js">
    <link rel="modulepreload" crossorigin href="./assets/useAddCell-DYfGo4T8.js">
    <link rel="modulepreload" crossorigin href="./assets/toggle-PGHtwx2G.js">
    <link rel="modulepreload" crossorigin href="./assets/api-CoLss8_O.js">
    <link rel="modulepreload" crossorigin href="./assets/globals-oV9pRUSB.js">
    <link rel="modulepreload" crossorigin href="./assets/share-DjbnD3WE.js">
    <link rel="modulepreload" crossorigin href="./assets/memoize-DN0TMY36.js">
    <link rel="modulepreload" crossorigin href="./assets/get-CyLJYAfP.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseSet-CKSmZC_I.js">
    <link rel="modulepreload" crossorigin href="./assets/utilities.esm-DvrcU9Ky.js">
    <link rel="modulepreload" crossorigin href="./assets/floating-outline-DmCT2Mvg.js">
    <link rel="modulepreload" crossorigin href="./assets/eye-off-BUwXWtH0.js">
    <link rel="modulepreload" crossorigin href="./assets/plus-CiGrWbgb.js">
    <link rel="modulepreload" crossorigin href="./assets/readonly-python-code-CkaJ4Tks.js">
    <link rel="modulepreload" crossorigin href="./assets/file-video-camera-BGBfFNDn.js">
    <link rel="modulepreload" crossorigin href="./assets/file-text-O5IflCIn.js">
    <link rel="modulepreload" crossorigin href="./assets/file-CqXxt3_J.js">
    <link rel="modulepreload" crossorigin href="./assets/types-BMriRmf-.js">
    <link rel="modulepreload" crossorigin href="./assets/label-4Nancvon.js">
    <link rel="modulepreload" crossorigin href="./assets/textarea-BnZHy5Jt.js">
    <link rel="modulepreload" crossorigin href="./assets/circle-x-Cc9X6U_B.js">
    <link rel="modulepreload" crossorigin href="./assets/refresh-ccw-aU2rUkrI.js">
    <link rel="modulepreload" crossorigin href="./assets/trash-2-Du5ITnDv.js">
    <link rel="modulepreload" crossorigin href="./assets/form-600t_Civ.js">
    <link rel="modulepreload" crossorigin href="./assets/field-Dov6YyOV.js">
    <link rel="modulepreload" crossorigin href="./assets/switch-Ct8mUApv.js">
    <link rel="modulepreload" crossorigin href="./assets/useBoolean-Dmwks1uh.js">
    <link rel="modulepreload" crossorigin href="./assets/useDeepCompareMemoize-C8RdAYFq.js">
    <link rel="modulepreload" crossorigin href="./assets/types-D0WVpW93.js">
    <link rel="modulepreload" crossorigin href="./assets/prop-types-WJwGTMoZ.js">
    <link rel="modulepreload" crossorigin href="./assets/es-DAmFxw3U.js">
    <link rel="modulepreload" crossorigin href="./assets/VisuallyHidden-RqykLBKh.js">
    <link rel="modulepreload" crossorigin href="./assets/_baseFlatten-rM2FaX4x.js">
    <link rel="modulepreload" crossorigin href="./assets/hasIn-CE-pxQP-.js">
    <link rel="modulepreload" crossorigin href="./assets/_basePickBy-LbasZ8ix.js">
    <link rel="modulepreload" crossorigin href="./assets/pick-FbHfDtcJ.js">
    <link rel="modulepreload" crossorigin href="./assets/send-LAFRRDPT.js">
    <link rel="modulepreload" crossorigin href="./assets/code-xml-DdSOsi73.js">
    <link rel="modulepreload" crossorigin href="./assets/download-Dmmu2U4a.js">
    <link rel="modulepreload" crossorigin href="./assets/globe-vMZtva7z.js">
    <link rel="modulepreload" crossorigin href="./assets/refresh-cw-BOc7UXm9.js">
    <link rel="modulepreload" crossorigin href="./assets/settings-DznrHqbd.js">
    <link rel="modulepreload" crossorigin href="./assets/square-DhlBDqyx.js">
    <link rel="modulepreload" crossorigin href="./assets/triangle-alert-Bf1kg4xT.js">
    <link rel="modulepreload" crossorigin href="./assets/dist-DL3W3q-2.js">
    <link rel="modulepreload" crossorigin href="./assets/bundle.esm-C-9IAWQU.js">
    <link rel="stylesheet" crossorigin href="./assets/cells-wU8qigWB.css">
    <link rel="stylesheet" crossorigin href="./assets/Output-DUep6sC9.css">
    <link rel="stylesheet" crossorigin href="./assets/ConsoleOutput-BFFTcC5Y.css">
    <link rel="stylesheet" crossorigin href="./assets/index-CJU5NUvF.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="">import%20marimo%0A%0A__generated_with%20%3D%20%220.18.4%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20import%20marimo%20as%20mo%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20warnings%0A%20%20%20%20import%20pulp%0A%20%20%20%20import%20re%0A%0A%20%20%20%20from%20statsmodels.tsa.arima.model%20import%20ARIMA%0A%20%20%20%20from%20sklearn.metrics%20import%20mean_absolute_error%2C%20mean_squared_error%0A%20%20%20%20from%20statsmodels.tools.sm_exceptions%20import%20ValueWarning%2C%20ConvergenceWarning%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20ARIMA%2C%0A%20%20%20%20%20%20%20%20ConvergenceWarning%2C%0A%20%20%20%20%20%20%20%20ValueWarning%2C%0A%20%20%20%20%20%20%20%20mean_absolute_error%2C%0A%20%20%20%20%20%20%20%20mean_squared_error%2C%0A%20%20%20%20%20%20%20%20np%2C%0A%20%20%20%20%20%20%20%20pd%2C%0A%20%20%20%20%20%20%20%20pulp%2C%0A%20%20%20%20%20%20%20%20warnings%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Part%20A%3A%20Replicating%20trends%20from%20paper%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Data%20Preprocessing%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(pd)%3A%0A%20%20%20%20%23%23%20Data%20Cleaning%20Functions%0A%20%20%20%20def%20rename_columns(df)%3A%0A%20%20%20%20%20%20%20%20return%20df.rename(%0A%20%20%20%20%20%20%20%20%20%20%20%20columns%3D%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Date%20of%20write%20up%22%3A%20%22date%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Job%20Description%22%3A%20%22lens_type%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20)%0A%0A%0A%20%20%20%20def%20fix_dates(df)%3A%0A%20%20%20%20%20%20%20%20df%5B%22date%22%5D%20%3D%20pd.to_datetime(%0A%20%20%20%20%20%20%20%20%20%20%20%20df%5B%22date%22%5D%2C%20format%3D%22mixed%22%2C%20dayfirst%3DTrue%2C%20errors%3D%22coerce%22%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20return%20df%0A%0A%0A%20%20%20%20def%20filter_by_lens_list(df%2C%20lens_list)%3A%0A%20%20%20%20%20%20%20%20%22%22%22Filters%20the%20dataframe%20to%20keep%20only%20the%20top%2030%20lenses%20in%20the%20df%22%22%22%0A%20%20%20%20%20%20%20%20return%20df%5Bdf%5B%22lens_type%22%5D.isin(lens_list)%5D.copy()%0A%0A%0A%20%20%20%20def%20aggregate_quarterly(df)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Groups%20transactions%20by%20Quarter%20and%20Lens%20Type.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20df.groupby(%5B%22lens_type%22%2C%20pd.Grouper(key%3D%22date%22%2C%20freq%3D%22QE%22)%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20.size()%0A%20%20%20%20%20%20%20%20%20%20%20%20.reset_index(name%3D%22demand%22)%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20return%20aggregate_quarterly%2C%20filter_by_lens_list%2C%20fix_dates%2C%20rename_columns%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Lab%20Data%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(pd)%3A%0A%20%20%20%20df_lab_data%20%3D%20pd.read_excel(%22.%2FLens%20Data.xlsx%22%2C%20sheet_name%3D%22Lab%20Data%22)%0A%20%20%20%20df_lab_data%0A%20%20%20%20return%20(df_lab_data%2C)%0A%0A%0A%40app.cell%0Adef%20_(df_lab_data%2C%20fix_dates%2C%20rename_columns)%3A%0A%20%20%20%20df_lab_clean%20%3D%20(%0A%20%20%20%20%20%20%20%20df_lab_data.pipe(rename_columns)%0A%20%20%20%20%20%20%20%20.pipe(fix_dates)%0A%20%20%20%20%20%20%20%20.dropna(subset%3D%5B%22date%22%2C%20%22lens_type%22%5D)%0A%20%20%20%20%20%20%20%20.drop(%5B%22Lab%2FInvoice%20%23%22%2C%20%22FRAME%20INFO%22%2C%20%22Contacted%22%5D%2C%20axis%3D1)%0A%20%20%20%20)%0A%0A%20%20%20%20df_lab_clean%5B%22lens_type%22%5D%20%3D%20(%0A%20%20%20%20%20%20%20%20df_lab_clean%5B%22lens_type%22%5D%0A%20%20%20%20%20%20%20%20.str.lower()%0A%20%20%20%20%20%20%20%20%23%20.str.strip()%0A%20%20%20%20%20%20%20%20%23%20.str.replace(r%22%5Cs*%2C%5Cs*%22%2C%20%22%2C%20%22%2C%20regex%3DTrue)%0A%20%20%20%20)%0A%0A%20%20%20%20df_lab_clean.head()%0A%20%20%20%20return%20(df_lab_clean%2C)%0A%0A%0A%40app.cell%0Adef%20_(aggregate_quarterly%2C%20df_lab_clean%2C%20filter_by_lens_list)%3A%0A%20%20%20%20top_30_lens%20%3D%20(%0A%20%20%20%20%20%20%20%20df_lab_clean%5B%22lens_type%22%5D%0A%20%20%20%20%20%20%20%20.value_counts()%0A%20%20%20%20%20%20%20%20.reset_index()%0A%20%20%20%20%20%20%20%20.sort_values(by%3D%5B%22count%22%2C%20%22lens_type%22%5D%2C%20ascending%3D%5BFalse%2C%20False%5D)%0A%20%20%20%20%20%20%20%20.head(30)%0A%20%20%20%20)%0A%0A%20%20%20%20unique_lens%20%3D%20top_30_lens%5B%22lens_type%22%5D.tolist()%0A%0A%20%20%20%20time_series_data%20%3D%20(%0A%20%20%20%20%20%20%20%20df_lab_clean%0A%20%20%20%20%20%20%20%20.pipe(filter_by_lens_list%2C%20lens_list%3Dunique_lens)%0A%20%20%20%20%20%20%20%20.pipe(aggregate_quarterly)%0A%20%20%20%20%20%20%20%20.pivot(index%3D%22date%22%2C%20columns%3D%22lens_type%22%2C%20values%3D%22demand%22)%0A%20%20%20%20%20%20%20%20.fillna(0)%0A%20%20%20%20%20%20%20%20.asfreq(%22QE-DEC%22)%0A%20%20%20%20%20%20%20%20%23%20.tail(18)%0A%20%20%20%20)%0A%0A%20%20%20%20time_series_data%0A%20%20%20%20return%20(time_series_data%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Cost%20Data%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(pd)%3A%0A%20%20%20%20cost_df%20%3D%20pd.read_excel(%22Lens%20Data.xlsx%22%2C%20sheet_name%3D%22Cost%20data%22)%0A%20%20%20%20cost_df%20%3D%20(%0A%20%20%20%20%20%20%20%20cost_df.pipe(lambda%20df%3A%20df.rename(columns%3D%7Bdf.columns%5B0%5D%3A%20%22lens_type%22%7D))%0A%20%20%20%20%20%20%20%20.rename(%0A%20%20%20%20%20%20%20%20%20%20%20%20columns%3D%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22ordering_cost_TTD%22%3A%20%22direct_cost%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22middleman_fee%22%3A%20%22middleman_cost%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22holding_cost_per_unit%22%3A%20%22holding_cost%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Description%22%3A%20%22description%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Overall%20Demand%22%3A%20%22demand%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20.assign(%0A%20%20%20%20%20%20%20%20%20%20%20%20lens_type%3Dlambda%20df%3A%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20df%5B%22lens_type%22%5D.astype(str).str.lstrip(%220123456789%20%5Ct%22).str.strip()%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20.set_index(%22lens_type%22)%0A%20%20%20%20)%0A%0A%20%20%20%20cost_df.head()%0A%20%20%20%20return%20(cost_df%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Forecasting%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Arima%20Implementation%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(ARIMA%2C%20ConvergenceWarning%2C%20ValueWarning%2C%20warnings)%3A%0A%20%20%20%20warnings.simplefilter(%22ignore%22%2C%20category%3DUserWarning)%0A%20%20%20%20warnings.simplefilter(%22ignore%22%2C%20category%3DConvergenceWarning)%0A%20%20%20%20warnings.simplefilter(%22ignore%22%2C%20category%3DValueWarning)%0A%0A%0A%20%20%20%20def%20fit_best_arima(series)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Simple%20Grid%20search%20p%2Cd%2Cq%20in%20%7B0%2C1%7D%20to%20find%20best%20order%0A%20%20%20%20%20%20%20%20of%20autoregressive%2C%20differences%2C%20and%20moving%20components%0A%20%20%20%20%20%20%20%20then%20forecast%20using%20best%20aic%0A%20%20%20%20%20%20%20%20%22%22%22%0A%0A%20%20%20%20%20%20%20%20best_aic%20%3D%20float(%22inf%22)%0A%20%20%20%20%20%20%20%20best_model%20%3D%20None%0A%0A%20%20%20%20%20%20%20%20%23%20Simplified%20grid%20search%20over%20precomputed%20p%2Cd%2Cq%0A%20%20%20%20%20%20%20%20orders%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%200%2C%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%200%2C%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%201%2C%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%200%2C%201)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%201%2C%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%200%2C%201)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%201%2C%201)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%201%2C%201)%2C%0A%20%20%20%20%20%20%20%20%5D%0A%0A%20%20%20%20%20%20%20%20for%20order%20in%20orders%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model%20%3D%20ARIMA(series%2C%20order%3Dorder%2C%20missing%3D%22drop%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20results%20%3D%20model.fit()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20results.aic%20%3C%20best_aic%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20best_aic%20%3D%20results.aic%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20best_model%20%3D%20results%0A%20%20%20%20%20%20%20%20%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Failed%20to%20fit%20order%20%7Border%7D%3A%20%7Be%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%0A%20%20%20%20%20%20%20%20if%20best_model%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20best_model%0A%0A%20%20%20%20%20%20%20%20print(%0A%20%20%20%20%20%20%20%20%20%20%20%20f%22WARNING%3A%20No%20suitable%20ARIMA%20model%20found%20for%20series.%20Defaulting%20to%20mean%20model%20(0%2C0%2C0).%22%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Fallback%3A%20Return%20a%20simple%20mean%20model%20if%20everything%20failed%0A%20%20%20%20%20%20%20%20%23%20return%20ARIMA(series%2C%20order%3D(0%2C%200%2C%200)).fit()%0A%20%20%20%20return%20(fit_best_arima%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Arima%20Rolling%20Evaluation%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(fit_best_arima%2C%20mean_absolute_error%2C%20mean_squared_error%2C%20np)%3A%0A%20%20%20%20from%20tqdm%20import%20tqdm%0A%0A%20%20%20%20def%20rolling_arima_eval(series%2C%20min_train%3D8)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Performs%20rolling%20origin%20evaluation%20using%20your%20existing%20predict_arima_next%20function.%0A%20%20%20%20%20%20%20%20Extracts%20only%20the%201st%20step%20of%20the%204-step%20forecast%20for%20validation.%0A%0A%20%20%20%20%20%20%20%20min_train%3A%20minimum%20quarters%20needed%20for%20training.%208%20was%20chosen%20since%20paper%20mentioned%0A%20%20%20%20%20%20%20%20%20%20%20%20using%202%20years%20of%20historical%20data%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20actuals%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20forecasts%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20for%20i%20in%20range(min_train%2C%20len(series))%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20train%20%3D%20series.iloc%5B%3Ai%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20actual%20%3D%20series.iloc%5Bi%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20arima_model%20%3D%20fit_best_arima(train)%0A%20%20%20%20%20%20%20%20%20%20%20%20pred_val%20%3D%20arima_model.forecast(steps%3D1).iloc%5B0%5D.round()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20forecasts.append(pred_val)%0A%20%20%20%20%20%20%20%20%20%20%20%20actuals.append(actual)%0A%0A%20%20%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22MAE%22%3A%20mean_absolute_error(actuals%2C%20forecasts)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22RMSE%22%3A%20np.sqrt(mean_squared_error(actuals%2C%20forecasts))%2C%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20return%20rolling_arima_eval%2C%20tqdm%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Prophet%20Implementation%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mean_absolute_error%2C%20mean_squared_error%2C%20np%2C%20warnings)%3A%0A%20%20%20%20from%20prophet%20import%20Prophet%0A%20%20%20%20import%20logging%0A%0A%20%20%20%20%23%20%23%20Suppress%20Prophet%20logging%20to%20keep%20output%20clean%0A%20%20%20%20logging.getLogger(%22prophet%22).setLevel(logging.ERROR)%0A%20%20%20%20logging.getLogger(%22cmdstanpy%22).setLevel(logging.ERROR)%0A%20%20%20%20warnings.filterwarnings(%22ignore%22%2C%20category%3DFutureWarning%2C%20module%3D%22prophet%22)%0A%0A%0A%20%20%20%20def%20predict_prophet_next(series%2C%20steps%3D1)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Fits%20Prophet%20with%20paper-specific%20priors%20and%20forecasts%201%20step%20ahead.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20df%20%3D%20series.reset_index()%0A%20%20%20%20%20%20%20%20df.columns%20%3D%20%5B%22ds%22%2C%20%22y%22%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Paper%20specs%3A%20changepoint_prior_scale%3D0.01%2C%20seasonality_prior_scale%3D10%0A%20%20%20%20%20%20%20%20m%20%3D%20Prophet(%0A%20%20%20%20%20%20%20%20%20%20%20%20changepoint_prior_scale%3D0.01%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20seasonality_prior_scale%3D10.0%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20yearly_seasonality%3DTrue%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20weekly_seasonality%3DFalse%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20daily_seasonality%3DFalse%2C%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20m.fit(df)%0A%0A%20%20%20%20%20%20%20%20%23%20Forecast%20next%20quarter%0A%20%20%20%20%20%20%20%20future%20%3D%20m.make_future_dataframe(periods%3Dsteps%2C%20freq%3D%22Q%22)%0A%20%20%20%20%20%20%20%20forecast%20%3D%20m.predict(future)%0A%0A%20%20%20%20%20%20%20%20return%20forecast%5B%22yhat%22%5D.iloc%5B-1%5D%0A%0A%0A%20%20%20%20def%20rolling_prophet_eval(series%2C%20min_train%3D8)%3A%0A%20%20%20%20%20%20%20%20actuals%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20forecasts%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20for%20i%20in%20range(min_train%2C%20len(series))%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20train%20%3D%20series.iloc%5B%3Ai%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20actual%20%3D%20series.iloc%5Bi%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20pred_val%20%3D%20predict_prophet_next(train)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20forecasts.append(pred_val)%0A%20%20%20%20%20%20%20%20%20%20%20%20actuals.append(actual)%0A%0A%20%20%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22MAE%22%3A%20mean_absolute_error(actuals%2C%20forecasts)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22RMSE%22%3A%20np.sqrt(mean_squared_error(actuals%2C%20forecasts))%2C%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20return%20predict_prophet_next%2C%20rolling_prophet_eval%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Forecasting%20Training%20Loop%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20results%20%3D%20%5B%5D%0A%20%20%20%20%23%20target_lenses%20%3D%20%5B%0A%20%20%20%20%23%20%20%20%20%20%22prog%2C%20trans%22%2C%0A%20%20%20%20%23%20%20%20%20%20%22sv%2C%20bb%22%2C%0A%20%20%20%20%23%20%20%20%20%20%22sv%2C%20trans%2C%20bb%22%2C%0A%20%20%20%20%23%20%20%20%20%20%22repair%22%2C%0A%20%20%20%20%23%20%20%20%20%20%22sv%2C%20poly%22%2C%0A%20%20%20%20%23%20%20%20%20%20%22sv%2C%20clear%22%2C%0A%20%20%20%20%23%20%5D%0A%0A%20%20%20%20%23%20%23%20To%20match%20the%20demand%20from%20the%20paper%2C%20the%20last%2018%20quarters%20are%20used%0A%20%20%20%20%23%20timeseries_18%20%3D%20(%0A%20%20%20%20%23%20%20%20%20%20time_series_data%0A%20%20%20%20%23%20%20%20%20%20.tail(18)%0A%20%20%20%20%23%20%20%20%20%20.copy()%0A%20%20%20%20%23%20)%0A%0A%0A%20%20%20%20%23%20lenses_to_process%20%3D%20%5Bl%20for%20l%20in%20target_lenses%20if%20l%20in%20timeseries_18.columns%5D%0A%0A%20%20%20%20%23%20%23%20Single%20loop%20for%20both%20models%0A%20%20%20%20%23%20for%20col%20in%20tqdm(lenses_to_process%2C%20desc%3D%22Processing%20Lenses%22)%3A%0A%20%20%20%20%23%20%20%20%20%20series%20%3D%20timeseries_18%5Bcol%5D%0A%20%20%20%20%23%20%20%20%20%20total_demand%20%3D%20series.sum()%0A%0A%20%20%20%20%23%20%20%20%20%20%23%20Fit%20ARIMA%20model%0A%20%20%20%20%23%20%20%20%20%20arima_res%20%3D%20rolling_arima_eval(series)%0A%0A%20%20%20%20%23%20%20%20%20%20%23%20Fit%20Prophet%0A%20%20%20%20%23%20%20%20%20%20prophet_res%20%3D%20rolling_prophet_eval(series)%0A%0A%20%20%20%20%23%20%20%20%20%20%23%20Ref%3A%20Table%20I%20shows%20'Difference'%20columns%0A%20%20%20%20%23%20%20%20%20%20diff_mae%20%3D%20prophet_res%5B%22MAE%22%5D%20-%20arima_res%5B%22MAE%22%5D%0A%20%20%20%20%23%20%20%20%20%20diff_rmse%20%3D%20prophet_res%5B%22RMSE%22%5D%20-%20arima_res%5B%22RMSE%22%5D%0A%0A%20%20%20%20%23%20%20%20%20%20%23%20Obtain%20results%20for%20Table%201.%0A%20%20%20%20%23%20%20%20%20%20results.append(%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%22Combination%22%3A%20col%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%22Total%20Demand%22%3A%20total_demand%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Prophet%20Cols%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%22Prophet%20MAE%22%3A%20prophet_res%5B%22MAE%22%5D%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%22Prophet%20RMSE%22%3A%20prophet_res%5B%22RMSE%22%5D%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20ARIMA%20Cols%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%22ARIMA%20MAE%22%3A%20arima_res%5B%22MAE%22%5D%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%22ARIMA%20RMSE%22%3A%20arima_res%5B%22RMSE%22%5D%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Difference%20Cols%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%22Diff%20MAE%22%3A%20diff_mae%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20%22Diff%20RMSE%22%3A%20diff_rmse%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%23%20%20%20%20%20)%0A%0A%20%20%20%20%23%20%23%20Create%20final%20DataFrame%0A%20%20%20%20%23%20comparison_df%20%3D%20pd.DataFrame(results).round(3)%0A%20%20%20%20%23%20comparison_df%20%3D%20comparison_df.sort_values(by%3D%22Total%20Demand%22%2C%20ascending%3DFalse)%0A%0A%20%20%20%20%23%20comparison_df%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Forecasting%20Additional%20Quarters%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(fit_best_arima%2C%20pd%2C%20predict_prophet_next)%3A%0A%20%20%20%20def%20generate_forecast_scenario(history_df%2C%20steps%3D4%2C%20method%3D%22arima%22%2C%20custom_func%3DNone)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Generates%20a%20full%20inventory%20scenario%20(History%20%2B%20Forecast).%0A%20%20%20%20%20%20%20%20Uses%20helper%20functions%20for%20model-specific%20prediction%20logic.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%23%201.%20Ensure%20frequency%20exists%0A%20%20%20%20%20%20%20%20%23%20if%20history_df.index.freq%20is%20None%3A%0A%20%20%20%20%20%20%20%20history_df.index.freq%20%3D%20pd.infer_freq(history_df.index)%0A%0A%20%20%20%20%20%20%20%20future_vals%20%3D%20%7B%7D%0A%20%20%20%20%20%20%20%20print(%0A%20%20%20%20%20%20%20%20%20%20%20%20f%22Generating%20%7Bmethod.upper()%7D%20forecasts%20for%20%7Blen(history_df.columns)%7D%20products...%22%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20for%20col%20in%20history_df.columns%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20series%20%3D%20history_df%5Bcol%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20method%20%3D%3D%20%22arima%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Use%20ARIMA%20helper%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model%20%3D%20fit_best_arima(series)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20forecast_values%20%3D%20model.forecast(steps%3Dsteps).values%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20method%20%3D%3D%20%22prophet%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Use%20Prophet%20helper%20(Refactored%20call)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20forecast_values%20%3D%20predict_prophet_next(series%2C%20steps%3Dsteps)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20method%20%3D%3D%20%22sarima%22%20and%20custom_func%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20use%20SARIMA%20grid%20search%20helper%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model%20%3D%20custom_func(series)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20forecast_values%20%3D%20model.forecast(steps%3Dsteps).values%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20raise%20ValueError(f%22Method%20%7Bmethod%7D%20not%20supported%20or%20custom_func%20missing.%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20future_vals%5Bcol%5D%20%3D%20forecast_values%0A%0A%20%20%20%20%20%20%20%20%23%20---%20SHARED%20CLEANING%20%26%20MERGING%20---%0A%20%20%20%20%20%20%20%20%23%201.%20Generate%20future%20Date%20Index%0A%20%20%20%20%20%20%20%20last_date%20%3D%20history_df.index%5B-1%5D%0A%20%20%20%20%20%20%20%20freq%20%3D%20history_df.index.freq%0A%20%20%20%20%20%20%20%20future_dates%20%3D%20pd.date_range(%0A%20%20%20%20%20%20%20%20%20%20%20%20start%3Dlast_date%2C%20periods%3Dsteps%20%2B%201%2C%20freq%3Dfreq%0A%20%20%20%20%20%20%20%20)%5B1%3A%5D%0A%0A%20%20%20%20%20%20%20%20%23%202.%20Create%20%26%20Clean%20Forecast%20DataFrame%0A%20%20%20%20%20%20%20%20forecast_df%20%3D%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20pd.DataFrame(future_vals%2C%20index%3Dfuture_dates)%0A%20%20%20%20%20%20%20%20%20%20%20%20.clip(lower%3D0)%0A%20%20%20%20%20%20%20%20%20%20%20%20.round(4)%0A%20%20%20%20%20%20%20%20%20%20%20%20.astype(int)%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20return%20forecast_df%0A%20%20%20%20return%20(generate_forecast_scenario%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Linear%20Programming%20Model%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(pd%2C%20pulp)%3A%0A%20%20%20%20def%20optimize_inventory(demand_df%2C%20cost_df%2C%20budget_per_quarter)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Optimizes%20lens%20inventory%20procurement.%0A%20%20%20%20%20%20%20%20Robust%20version%3A%20Handles%20bad%20data%20(NaNs)%20and%20failed%20solver%20states%20safely.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%0A%20%20%20%20%20%20%20%20%23%20Fill%20NaNs%20with%200%20to%20prevent%20solver%20crashes%0A%20%20%20%20%20%20%20%20demand_df%20%3D%20demand_df.fillna(0)%0A%20%20%20%20%20%20%20%20cost_df%20%3D%20cost_df.fillna(0)%0A%0A%20%20%20%20%20%20%20%20%23%20Check%20orientation%0A%20%20%20%20%20%20%20%20common_cols%20%3D%20len(demand_df.columns.intersection(cost_df.index))%0A%20%20%20%20%20%20%20%20common_index%20%3D%20len(demand_df.index.intersection(cost_df.index))%0A%0A%20%20%20%20%20%20%20%20if%20common_cols%20%3E%20common_index%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Note%3A%20Transposing%20demand_df%20to%20match%20(Products%20x%20Quarters)%20format...%22%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20demand_df%20%3D%20demand_df.transpose()%0A%0A%20%20%20%20%20%20%20%20%23%20Setup%20Parameters%0A%20%20%20%20%20%20%20%20quarter_cols%20%3D%20demand_df.columns.tolist()%0A%20%20%20%20%20%20%20%20quarter_keys%20%3D%20%5Bstr(q)%20for%20q%20in%20quarter_cols%5D%0A%20%20%20%20%20%20%20%20time_map%20%3D%20dict(zip(quarter_keys%2C%20quarter_cols))%0A%0A%20%20%20%20%20%20%20%20products%20%3D%20demand_df.index.tolist()%0A%0A%20%20%20%20%20%20%20%20%23%20Filter%20valid%20products%0A%20%20%20%20%20%20%20%20valid_products%20%3D%20%5Bp%20for%20p%20in%20products%20if%20p%20in%20cost_df.index%5D%0A%20%20%20%20%20%20%20%20dropped%20%3D%20len(products)%20-%20len(valid_products)%0A%20%20%20%20%20%20%20%20if%20dropped%20%3E%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22Warning%3A%20Dropped%20%7Bdropped%7D%20items%20from%20demand%20that%20were%20missing%20in%20cost%20table.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20products%20%3D%20valid_products%0A%0A%20%20%20%20%20%20%20%20profit_margin%20%3D%200.10%0A%20%20%20%20%20%20%20%20prob%20%3D%20pulp.LpProblem(%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Optical_Lens_Inventory_Optimization%22%2C%20pulp.LpMaximize%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Define%20Variables%0A%20%20%20%20%20%20%20%20keys%20%3D%20%5B(q%2C%20p)%20for%20q%20in%20quarter_keys%20for%20p%20in%20products%5D%0A%0A%20%20%20%20%20%20%20%20q_vars%20%3D%20pulp.LpVariable.dicts(%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Order_Qty%22%2C%20keys%2C%20lowBound%3D0%2C%20cat%3D%22Integer%22%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20f_vars%20%3D%20pulp.LpVariable.dicts(%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Fulfilled_Direct%22%2C%20keys%2C%20lowBound%3D0%2C%20cat%3D%22Integer%22%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20s_vars%20%3D%20pulp.LpVariable.dicts(%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Stock_End%22%2C%20keys%2C%20lowBound%3D0%2C%20cat%3D%22Integer%22%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20m_vars%20%3D%20pulp.LpVariable.dicts(%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Middleman_Stock%22%2C%20keys%2C%20lowBound%3D0%2C%20cat%3D%22Integer%22%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Objective%20Function%0A%20%20%20%20%20%20%20%20objective_terms%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20%23%20t_str%20-%20time%20period%0A%20%20%20%20%20%20%20%20for%20t_str%20in%20quarter_keys%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20t_original%20%3D%20time_map%5Bt_str%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20k%20-%20combination%20index%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20k%20in%20products%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20D_tk%20%3D%20float(demand_df.at%5Bk%2C%20t_original%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C_c%20%3D%20float(cost_df.at%5Bk%2C%20%22direct_cost%22%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C_m%20%3D%20float(cost_df.at%5Bk%2C%20%22middleman_cost%22%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20C_h%20%3D%20float(cost_df.at%5Bk%2C%20%22holding_cost%22%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f_tk%20%3D%20f_vars%5B(t_str%2C%20k)%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s_tk%20%3D%20s_vars%5B(t_str%2C%20k)%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20m_tk%20%3D%20m_vars%5B(t_str%2C%20k)%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prob%20%2B%3D%20m_tk%20%3E%3D%20D_tk%20-%20f_tk%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Profit%20Terms%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20direct_profit%20%3D%20profit_margin%20*%20C_c%20*%20f_tk%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20middleman_cost%20%3D%20C_m%20*%20m_tk%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20holding_cost%20%3D%20C_h%20*%20s_tk%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20objective_terms.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20direct_profit%20-%20middleman_cost%20-%20holding_cost%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20prob%20%2B%3D%20pulp.lpSum(objective_terms)%2C%20%22Total_Profit%22%0A%0A%20%20%20%20%20%20%20%20%23%20Constraints%0A%20%20%20%20%20%20%20%20for%20t_idx%2C%20t_str%20in%20enumerate(quarter_keys)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20t_original%20%3D%20time_map%5Bt_str%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Budget%20Constraint%0A%20%20%20%20%20%20%20%20%20%20%20%20quarterly_spend%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20q_vars%5B(t_str%2C%20k)%5D%20*%20float(cost_df.at%5Bk%2C%20%22direct_cost%22%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20k%20in%20products%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20prob%20%2B%3D%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20pulp.lpSum(quarterly_spend)%20%3C%3D%20budget_per_quarter%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22Budget_%7Bt_str%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20k%20in%20products%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Previous%20Inventory%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20t_idx%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s_prev%20%3D%200%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prev_q_str%20%3D%20quarter_keys%5Bt_idx%20-%201%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s_prev%20%3D%20s_vars%5B(prev_q_str%2C%20k)%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Inventory%20Balance%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prob%20%2B%3D%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s_vars%5B(t_str%2C%20k)%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%3D%20s_prev%20%2B%20q_vars%5B(t_str%2C%20k)%5D%20-%20f_vars%5B(t_str%2C%20k)%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22Inv_Bal_%7Bt_str%7D_%7Bk%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Fulfillment%20Constraints%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20D_tk%20%3D%20float(demand_df.at%5Bk%2C%20t_original%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prob%20%2B%3D%20f_vars%5B(t_str%2C%20k)%5D%20%3C%3D%20D_tk%2C%20f%22Max_Demand_%7Bt_str%7D_%7Bk%7D%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20prob%20%2B%3D%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f_vars%5B(t_str%2C%20k)%5D%20%3C%3D%20s_prev%20%2B%20q_vars%5B(t_str%2C%20k)%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22Max_Stock_%7Bt_str%7D_%7Bk%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Solve%20Model%0A%20%20%20%20%20%20%20%20%23%20Use%20a%20generous%20time%20limit%20to%20prevent%20%22No%20Solution%22%20errors%20on%20complex%20data%0A%20%20%20%20%20%20%20%20solver%20%3D%20pulp.PULP_CBC_CMD(msg%3DTrue%2C%20gapRel%3D0.05%2C%20timeLimit%3D30)%0A%20%20%20%20%20%20%20%20prob.solve(solver)%0A%0A%20%20%20%20%20%20%20%20%23%20SAFETY%20CHECK%0A%20%20%20%20%20%20%20%20status_str%20%3D%20pulp.LpStatus%5Bprob.status%5D%0A%20%20%20%20%20%20%20%20if%20prob.status%20!%3D%20pulp.LpStatusOptimal%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f%22%5CnCRITICAL%20WARNING%3A%20Solver%20failed%20with%20status%20'%7Bstatus_str%7D'.%20Results%20may%20be%20empty.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20results%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20def%20safe_val(var)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20val%20%3D%20pulp.value(var)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20val%20if%20val%20is%20not%20None%20else%200.0%0A%0A%20%20%20%20%20%20%20%20for%20t_str%20in%20quarter_keys%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20t_original%20%3D%20time_map%5Bt_str%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20k%20in%20products%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Safe%20extraction%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20val_q%20%3D%20safe_val(q_vars%5B(t_str%2C%20k)%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20val_f%20%3D%20safe_val(f_vars%5B(t_str%2C%20k)%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20val_s%20%3D%20safe_val(s_vars%5B(t_str%2C%20k)%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20val_d%20%3D%20float(demand_df.at%5Bk%2C%20t_original%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20val_m%20%3D%20max(0%2C%20val_d%20-%20val_f)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Costs%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c_direct%20%3D%20float(cost_df.at%5Bk%2C%20%22direct_cost%22%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c_middle%20%3D%20float(cost_df.at%5Bk%2C%20%22middleman_cost%22%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20c_holding%20%3D%20float(cost_df.at%5Bk%2C%20%22holding_cost%22%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Financials%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20spend_direct%20%3D%20val_q%20*%20c_direct%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20spend_middle%20%3D%20val_m%20*%20c_middle%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20spend_holding%20%3D%20val_s%20*%20c_holding%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20total_item_cost%20%3D%20spend_direct%20%2B%20spend_middle%20%2B%20spend_holding%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20results.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Quarter%22%3A%20t_original%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Product%22%3A%20k%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Demand%22%3A%20val_d%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Direct_Order%22%3A%20val_q%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Fulfilled_Direct%22%3A%20val_f%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Middleman_Units%22%3A%20val_m%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22End_Stock%22%3A%20val_s%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Financial%20Columns%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Budget_Utilized_(%24)%22%3A%20spend_direct%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Middleman_Cost_(%24)%22%3A%20spend_middle%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Holding_Cost_(%24)%22%3A%20spend_holding%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Total_Cost_(%24)%22%3A%20total_item_cost%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22status%22%3A%20status_str%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22total_profit%22%3A%20pulp.value(prob.objective)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20pulp.value(prob.objective)%0A%20%20%20%20%20%20%20%20%20%20%20%20else%200.0%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22results_df%22%3A%20pd.DataFrame(results).set_index(%22Quarter%22)%2C%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20return%20(optimize_inventory%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Allocation%0A%20%20%20%20Solving%20for%20Table%202.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(optimize_inventory%2C%20pd)%3A%0A%20%20%20%20def%20evaluate_budget_scenarios(demand_df%2C%20cost_df%2C%20budgets)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Runs%20the%20inventory%20optimization%20model%20across%20multiple%20budget%20levels.%0A%20%20%20%20%20%20%20%20Returns%20a%20summary%20DataFrame%20comparing%20financial%20performance.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20summary_data%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20%23%201.%20Ensure%20we%20are%20only%20running%20on%20the%20Top%2030%20products%20to%20match%20paper%20scale%0A%20%20%20%20%20%20%20%20%23%20(Assuming%20cost_df%20index%20represents%20the%20valid%20Top%2030%20list)%0A%20%20%20%20%20%20%20%20valid_products%20%3D%20%5Bp%20for%20p%20in%20demand_df.columns%20if%20p%20in%20cost_df.index%5D%0A%20%20%20%20%20%20%20%20demand_df_filtered%20%3D%20demand_df%5Bvalid_products%5D.copy()%0A%0A%20%20%20%20%20%20%20%20print(%0A%20%20%20%20%20%20%20%20%20%20%20%20f%22Evaluating%20%7Blen(budgets)%7D%20budget%20scenarios%20for%20%7Blen(valid_products)%7D%20products...%22%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20for%20b%20in%20budgets%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Run%20Optimization%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20(Using%20the%20robust%20'new'%20function%20from%20before)%0A%20%20%20%20%20%20%20%20%20%20%20%20output%20%3D%20optimize_inventory(demand_df_filtered%2C%20cost_df%2C%20b)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Get%20Data%0A%20%20%20%20%20%20%20%20%20%20%20%20df_res%20%3D%20output%5B%22results_df%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20total_profit%20%3D%20output%5B%22total_profit%22%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Calculate%20Aggregates%0A%20%20%20%20%20%20%20%20%20%20%20%20budget_utilized%20%3D%20df_res%5B%22Budget_Utilized_(%24)%22%5D.sum()%0A%20%20%20%20%20%20%20%20%20%20%20%20middleman_cost%20%3D%20df_res%5B%22Middleman_Cost_(%24)%22%5D.sum()%0A%20%20%20%20%20%20%20%20%20%20%20%20holding_cost%20%3D%20df_res%5B%22Holding_Cost_(%24)%22%5D.sum()%0A%20%20%20%20%20%20%20%20%20%20%20%20middleman_units%20%3D%20df_res%5B%22Middleman_Units%22%5D.sum()%0A%20%20%20%20%20%20%20%20%20%20%20%20total_cost%20%3D%20budget_utilized%20%2B%20middleman_cost%20%2B%20holding_cost%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Calculate%20ROI%20Metric%0A%20%20%20%20%20%20%20%20%20%20%20%20profit_per_10k%20%3D%20total_profit%20%2F%20(b%20%2F%2010000)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20summary_data.append(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Budget%20Scenario%22%3A%20b%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Total%20Profit%20(%24)%22%3A%20total_profit%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Total%20Cost%20(%24)%22%3A%20total_cost%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Middleman%20Cost%20(%24)%22%3A%20middleman_cost%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Middleman%20Units%22%3A%20middleman_units%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Budget%20Utilized%20(%24)%22%3A%20budget_utilized%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Profit%2F%2410k%22%3A%20profit_per_10k%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Status%22%3A%20output%5B%22status%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20return%20pd.DataFrame(summary_data).round(2)%0A%20%20%20%20return%20(evaluate_budget_scenarios%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20forecast_steps%20%3D%201%0A%20%20%20%20budgets%20%3D%20%5B10000%2C%2020000%2C%2030000%2C%2040000%2C%2050000%5D%0A%20%20%20%20return%20(budgets%2C)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20budgets%2C%0A%20%20%20%20cost_df%2C%0A%20%20%20%20evaluate_budget_scenarios%2C%0A%20%20%20%20generate_forecast_scenario%2C%0A%20%20%20%20pd%2C%0A%20%20%20%20time_series_data%2C%0A)%3A%0A%20%20%20%20prophet_forecast%20%3D%20generate_forecast_scenario(%0A%20%20%20%20%20%20%20%20time_series_data%2C%20steps%3D4%2C%20method%3D%22prophet%22%0A%20%20%20%20)%0A%20%20%20%20%23%20---%20PROPHET%20EVALUATION%20---%0A%20%20%20%20print(%22%5Cn---%20PROPHET%20RESULTS%20---%22)%0A%20%20%20%20df_prophet_results%20%3D%20evaluate_budget_scenarios(%0A%20%20%20%20%20%20%20%20pd.concat(%5Btime_series_data.tail(18)%2C%20prophet_forecast%5D)%2C%20cost_df%2C%20budgets%0A%20%20%20%20)%0A%20%20%20%20df_prophet_results%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20budgets%2C%0A%20%20%20%20cost_df%2C%0A%20%20%20%20evaluate_budget_scenarios%2C%0A%20%20%20%20generate_forecast_scenario%2C%0A%20%20%20%20pd%2C%0A%20%20%20%20time_series_data%2C%0A)%3A%0A%20%20%20%20arima_forecast%20%3D%20generate_forecast_scenario(%0A%20%20%20%20%20%20%20%20time_series_data%2C%20steps%3D12%2C%20method%3D%22arima%22%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20---%20ARIMA%20EVALUATION%20---%0A%20%20%20%20print(%22---%20ARIMA%20RESULTS%20---%22)%0A%20%20%20%20df_arima_results%20%3D%20evaluate_budget_scenarios(%0A%20%20%20%20%20%20%20%20pd.concat(%5Btime_series_data.tail(18)%2C%20arima_forecast%5D)%2C%20cost_df%2C%20budgets%0A%20%20%20%20)%0A%20%20%20%20df_arima_results%0A%20%20%20%20return%20arima_forecast%2C%20df_arima_results%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Part%20B%0A%20%20%20%20Compare%20the%20performance%20using%20the%20SARIMA%20forecasting%20model.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(ARIMA)%3A%0A%20%20%20%20def%20fit_best_sarima(series)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Grid%20searches%20for%20the%20best%20SARIMA%20model%20based%20on%20AIC.%0A%20%20%20%20%20%20%20%20Fixed%20Seasonality%20(s%3D4)%20for%20Quarterly%20data.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20best_aic%20%3D%20float(%22inf%22)%0A%20%20%20%20%20%20%20%20best_model%20%3D%20None%0A%0A%20%20%20%20%20%20%20%20%23%20Simplified%20Grid%3A%20(p%2Cd%2Cq)%20x%20(P%2CD%2CQ%2Cs)%0A%20%20%20%20%20%20%20%20orders%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%200%2C%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%200%2C%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%201%2C%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%200%2C%201)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%201%2C%200)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%200%2C%201)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%201%2C%201)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%201%2C%201)%2C%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20%20%20%20%20seasonal_orders%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%201%2C%201%2C%204)%2C%20%20%23%20Classic%20seasonal%20moving%20average%0A%20%20%20%20%20%20%20%20%20%20%20%20(1%2C%201%2C%200%2C%204)%2C%20%20%23%20Seasonal%20autoregressive%0A%20%20%20%20%20%20%20%20%20%20%20%20(0%2C%201%2C%200%2C%204)%2C%20%20%23%20Pure%20seasonal%20differencing%0A%20%20%20%20%20%20%20%20%5D%0A%0A%20%20%20%20%20%20%20%20for%20order%20in%20orders%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20seasonal_order%20in%20seasonal_orders%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Enforce%20stationarity%2Finvertibility%20to%20avoid%20bad%20models%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model%20%3D%20ARIMA(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20series%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20order%3Dorder%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20seasonal_order%3Dseasonal_order%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enforce_stationarity%3DFalse%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enforce_invertibility%3DFalse%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20results%20%3D%20model.fit()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20results.aic%20%3C%20best_aic%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20best_aic%20%3D%20results.aic%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20best_model%20%3D%20results%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20except%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%0A%20%20%20%20%20%20%20%20%23%20Fallback%20if%20grid%20search%20fails%20completely%0A%20%20%20%20%20%20%20%20if%20best_model%20is%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20ARIMA(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20series%2C%20order%3D(0%2C%200%2C%200)%2C%20seasonal_order%3D(0%2C%200%2C%200%2C%204)%0A%20%20%20%20%20%20%20%20%20%20%20%20).fit()%0A%0A%20%20%20%20%20%20%20%20return%20best_model%0A%20%20%20%20return%20(fit_best_sarima%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Table%20II.%20Forecast%20Accuracy%20Comparison%20for%20Selected%20Product%20Combinations%0A%20%20%20%20(Prophet%2C%20ARIMA%2C%20SARIMA)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20pd%2C%0A%20%20%20%20rolling_arima_eval%2C%0A%20%20%20%20rolling_prophet_eval%2C%0A%20%20%20%20rolling_sarima_eval%2C%0A%20%20%20%20time_series_data%2C%0A%20%20%20%20tqdm%2C%0A)%3A%0A%20%20%20%20results%20%3D%20%5B%5D%0A%20%20%20%20target_lenses%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%22prog%2C%20trans%22%2C%0A%20%20%20%20%20%20%20%20%22sv%2C%20bb%22%2C%0A%20%20%20%20%20%20%20%20%22sv%2C%20trans%2C%20bb%22%2C%0A%20%20%20%20%20%20%20%20%22repair%22%2C%0A%20%20%20%20%20%20%20%20%22sv%2C%20poly%22%2C%0A%20%20%20%20%20%20%20%20%22sv%2C%20clear%22%2C%0A%20%20%20%20%5D%0A%0A%20%20%20%20%23%20To%20match%20the%20demand%20from%20the%20paper%2C%20the%20last%2018%20quarters%20are%20used%0A%20%20%20%20timeseries_18%20%3D%20(%0A%20%20%20%20%20%20%20%20time_series_data%0A%20%20%20%20%20%20%20%20.tail(18)%0A%20%20%20%20%20%20%20%20.copy()%0A%20%20%20%20)%0A%0A%0A%20%20%20%20lenses_to_process%20%3D%20%5Bl%20for%20l%20in%20target_lenses%20if%20l%20in%20time_series_data.columns%5D%0A%0A%20%20%20%20%23%20Single%20loop%20for%20both%20models%0A%20%20%20%20for%20col%20in%20tqdm(lenses_to_process%2C%20desc%3D%22Processing%20Lenses%22)%3A%0A%20%20%20%20%20%20%20%20series%20%3D%20timeseries_18%5Bcol%5D%0A%20%20%20%20%20%20%20%20total_demand%20%3D%20series.sum()%0A%0A%20%20%20%20%20%20%20%20%23%201.%20Fit%20ARIMA%0A%20%20%20%20%20%20%20%20arima_res%20%3D%20rolling_arima_eval(series)%0A%0A%20%20%20%20%20%20%20%20%23%202.%20Fit%20Prophet%0A%20%20%20%20%20%20%20%20prophet_res%20%3D%20rolling_prophet_eval(series)%0A%0A%20%20%20%20%20%20%20%20%23%203.%20Fit%20SARIMA%20(New)%0A%20%20%20%20%20%20%20%20%23%20(Ensure%20rolling_sarima_eval%20function%20is%20defined%20from%20previous%20step)%0A%20%20%20%20%20%20%20%20sarima_res%20%3D%20rolling_sarima_eval(series)%0A%0A%20%20%20%20%20%20%20%20%23%20---%20Calculate%20Comparisons%20---%0A%0A%20%20%20%20%20%20%20%20%23%20Prophet%20vs%20ARIMA%20(Table%20I%20style%3A%20Negative%20means%20Prophet%20is%20better)%0A%20%20%20%20%20%20%20%20diff_mae_prophet%20%3D%20prophet_res%5B%22MAE%22%5D%20-%20arima_res%5B%22MAE%22%5D%0A%20%20%20%20%20%20%20%20diff_rmse_prophet%20%3D%20prophet_res%5B%22RMSE%22%5D%20-%20arima_res%5B%22RMSE%22%5D%0A%0A%20%20%20%20%20%20%20%20%23%20SARIMA%20vs%20ARIMA%20(Positive%20means%20SARIMA%20is%20better%2Flower%20error)%0A%20%20%20%20%20%20%20%20%23%20We%20calculate%20how%20much%20error%20SARIMA%20*reduced*%20compared%20to%20ARIMA%0A%20%20%20%20%20%20%20%20impv_mae_sarima%20%3D%20arima_res%5B%22MAE%22%5D%20-%20sarima_res%5B%22MAE%22%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Store%20Results%0A%20%20%20%20%20%20%20%20results.append(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Combination%22%3A%20col%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Total%20Demand%22%3A%20total_demand%2C%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Prophet%20Metrics%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Prophet%20MAE%22%3A%20prophet_res%5B%22MAE%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Prophet%20RMSE%22%3A%20prophet_res%5B%22RMSE%22%5D%2C%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20ARIMA%20Metrics%0A%20%20%20%20%20%20%20%20%20%20%20%20%22ARIMA%20MAE%22%3A%20arima_res%5B%22MAE%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22ARIMA%20RMSE%22%3A%20arima_res%5B%22RMSE%22%5D%2C%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20SARIMA%20Metrics%20(New)%0A%20%20%20%20%20%20%20%20%20%20%20%20%22SARIMA%20MAE%22%3A%20sarima_res%5B%22MAE%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22SARIMA%20RMSE%22%3A%20sarima_res%5B%22RMSE%22%5D%2C%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Comparisons%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Diff%20MAE%20(Prophet-ARIMA)%22%3A%20diff_mae_prophet%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Improvement%20(SARIMA%20vs%20ARIMA)%22%3A%20impv_mae_sarima%0A%20%20%20%20%20%20%20%20%7D)%0A%0A%20%20%20%20%23%20Create%20final%20DataFrame%0A%20%20%20%20comparison_df%20%3D%20pd.DataFrame(results).round(3)%0A%20%20%20%20comparison_df%20%3D%20comparison_df.sort_values(by%3D%22Total%20Demand%22%2C%20ascending%3DFalse)%0A%0A%20%20%20%20%23%20Reorder%20columns%20for%20a%20logical%20report%20view%0A%20%20%20%20cols%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%22Combination%22%2C%20%22Total%20Demand%22%2C%20%0A%20%20%20%20%20%20%20%20%22ARIMA%20MAE%22%2C%20%22Prophet%20MAE%22%2C%20%22SARIMA%20MAE%22%2C%20%0A%20%20%20%20%20%20%20%20%22Diff%20MAE%20(Prophet-ARIMA)%22%2C%20%22Improvement%20(SARIMA%20vs%20ARIMA)%22%0A%20%20%20%20%5D%0A%20%20%20%20comparison_df%20%3D%20comparison_df%5Bcols%5D%0A%20%20%20%20comparison_df%0A%20%20%20%20return%20(timeseries_18%2C)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20arima_forecast%2C%0A%20%20%20%20budgets%2C%0A%20%20%20%20cost_df%2C%0A%20%20%20%20evaluate_budget_scenarios%2C%0A%20%20%20%20fit_best_sarima%2C%0A%20%20%20%20generate_forecast_scenario%2C%0A%20%20%20%20pd%2C%0A%20%20%20%20time_series_data%2C%0A)%3A%0A%20%20%20%20sarima_forecast%20%3D%20generate_forecast_scenario(%0A%20%20%20%20%20%20%20%20time_series_data%2C%20steps%3D12%2C%20method%3D%22sarima%22%2C%20custom_func%3Dfit_best_sarima%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20---%20SARIMA%20EVALUATION%20---%0A%20%20%20%20print(%22---%20SARIMA%20RESULTS%20---%22)%0A%20%20%20%20df_sarima_results%20%3D%20evaluate_budget_scenarios(%0A%20%20%20%20%20%20%20%20pd.concat(%5Btime_series_data.tail(18)%2C%20arima_forecast%5D)%2C%20cost_df%2C%20budgets%0A%20%20%20%20)%0A%20%20%20%20df_sarima_results%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Part%20C%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20arima_forecast%2C%0A%20%20%20%20cost_df%2C%0A%20%20%20%20df_arima_results%2C%0A%20%20%20%20np%2C%0A%20%20%20%20optimize_inventory%2C%0A%20%20%20%20pd%2C%0A%20%20%20%20timeseries_18%2C%0A)%3A%0A%20%20%20%20import%20scipy.stats%20as%20stats%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%0A%20%20%20%20def%20get_prescription_weights(sigma%2C%20mean%3D0%2C%20start%3D-6%2C%20end%3D6%2C%20step%3D0.25)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Generates%20normalized%20probabilities%20for%20lens%20powers%20based%20on%20a%20Normal%20Distribution.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%23%20Generate%20discrete%20power%20steps%20(Diopters)%0A%20%20%20%20%20%20%20%20powers%20%3D%20np.arange(start%2C%20end%20%2B%20step%2C%20step)%0A%0A%20%20%20%20%20%20%20%20%23%20Calculate%20PDF%20(Probability%20Density%20Function)%0A%20%20%20%20%20%20%20%20%23%20We%20treat%20the%20discrete%20step%20as%20the%20center%20of%20a%20bin%0A%20%20%20%20%20%20%20%20probs%20%3D%20stats.norm.pdf(powers%2C%20loc%3Dmean%2C%20scale%3Dsigma)%0A%0A%20%20%20%20%20%20%20%20%23%20Normalize%20so%20they%20sum%20to%201%20(100%25%20of%20inventory)%0A%20%20%20%20%20%20%20%20probs%20%3D%20probs%20%2F%20probs.sum()%0A%0A%20%20%20%20%20%20%20%20return%20pd.Series(probs%2C%20index%3Dpowers)%0A%0A%20%20%20%20def%20simulate_prescription_impact(aggregate_results%2C%20cost_df%2C%20sigma_plan%2C%20sigma_actual)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Simulates%20the%20financial%20impact%20of%20distributing%20aggregate%20orders%20into%20specific%20powers.%0A%0A%20%20%20%20%20%20%20%20aggregate_results%3A%20The%20DataFrame%20output%20from%20your%20LP%20model%0A%20%20%20%20%20%20%20%20sigma_plan%3A%20The%20sigma%20used%20to%20buy%20inventory%20(Assumption)%0A%20%20%20%20%20%20%20%20sigma_actual%3A%20The%20sigma%20of%20actual%20customer%20demand%20(Reality)%0A%20%20%20%20%20%20%20%20%22%22%22%0A%0A%20%20%20%20%20%20%20%20%23%201.%20Get%20Weights%0A%20%20%20%20%20%20%20%20weights_plan%20%3D%20get_prescription_weights(sigma_plan)%0A%20%20%20%20%20%20%20%20weights_actual%20%3D%20get_prescription_weights(sigma_actual)%0A%0A%20%20%20%20%20%20%20%20total_real_profit%20%3D%200%0A%20%20%20%20%20%20%20%20total_mismatch_cost%20%3D%200%0A%0A%20%20%20%20%20%20%20%20%23%202.%20Iterate%20through%20every%20aggregate%20decision%0A%20%20%20%20%20%20%20%20%23%20We%20assume%20'aggregate_results'%20has%20columns%3A%20%5B'Product'%2C%20'Direct_Order'%2C%20'Demand'%5D%0A%20%20%20%20%20%20%20%20for%20_%2C%20row%20in%20aggregate_results.iterrows()%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20prod%20%3D%20row%5B'Product'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20prod%20not%20in%20cost_df.index%3A%20continue%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20qty_ordered%20%3D%20row%5B'Direct_Order'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20qty_demand_total%20%3D%20row%5B'Demand'%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Costs%0A%20%20%20%20%20%20%20%20%20%20%20%20c_direct%20%3D%20cost_df.at%5Bprod%2C%20'direct_cost'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20c_middle%20%3D%20cost_df.at%5Bprod%2C%20'middleman_cost'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20c_holding%20%3D%20cost_df.at%5Bprod%2C%20'holding_cost'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20profit_margin%20%3D%200.10%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%203.%20Distribute%20to%20Bins%20(The%20%22Micro%22%20Simulation)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Inventory%20is%20bought%20based%20on%20the%20PLAN%20distribution%0A%20%20%20%20%20%20%20%20%20%20%20%20stock_bins%20%3D%20(qty_ordered%20*%20weights_plan).round(0)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Customers%20arrive%20based%20on%20the%20ACTUAL%20distribution%0A%20%20%20%20%20%20%20%20%20%20%20%20demand_bins%20%3D%20(qty_demand_total%20*%20weights_actual).round(0)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%204.%20Calculate%20Fulfillment%20per%20Bin%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20For%20each%20power%20(e.g.%20%2B1.00)%2C%20we%20sell%20min(demand%2C%20stock)%0A%20%20%20%20%20%20%20%20%20%20%20%20sales_bins%20%3D%20np.minimum(stock_bins%2C%20demand_bins)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Unfulfilled%20demand%20goes%20to%20Middleman%0A%20%20%20%20%20%20%20%20%20%20%20%20middleman_bins%20%3D%20demand_bins%20-%20sales_bins%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Unsold%20stock%20incurs%20Holding%20Cost%0A%20%20%20%20%20%20%20%20%20%20%20%20leftover_bins%20%3D%20stock_bins%20-%20sales_bins%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%205.%20Calculate%20Financials%0A%20%20%20%20%20%20%20%20%20%20%20%20revenue%20%3D%20(sales_bins%20*%20c_direct%20*%20profit_margin).sum()%0A%20%20%20%20%20%20%20%20%20%20%20%20cost_middleman%20%3D%20(middleman_bins%20*%20c_middle).sum()%0A%20%20%20%20%20%20%20%20%20%20%20%20cost_holding%20%3D%20(leftover_bins%20*%20c_holding).sum()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Total%20Profit%20for%20this%20product%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Note%3A%20We%20paid%20for%20direct%20stock%20upfront!%20(qty_ordered%20*%20c_direct)%20is%20sunk%20cost%3F%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20The%20paper%20calculates%20profit%20as%3A%20Margin*Sold%20-%20MiddlemanCost%20-%20HoldingCost%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20It%20assumes%20the%20%22Cost%20of%20Goods%20Sold%22%20is%20covered%2C%20but%20we%20must%20subtract%20ordering%20cost%3F%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Following%20paper%20formula%3A%20Z%20%3D%20(Margin%20*%20Cost%20*%20Sold)%20-%20(MiddlemanCost)%20-%20(HoldingCost)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Note%3A%20This%20formula%20assumes%20we%20only%20profit%20on%20what%20we%20sell.%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20item_profit%20%3D%20revenue%20-%20cost_middleman%20-%20cost_holding%0A%20%20%20%20%20%20%20%20%20%20%20%20total_real_profit%20%2B%3D%20item_profit%0A%0A%20%20%20%20%20%20%20%20return%20total_real_profit%0A%0A%20%20%20%20%23%20---%20EXECUTE%20ANALYSIS%20---%0A%0A%20%20%20%20%23%201.%20Use%20your%20optimized%20results%20from%20Part%20A%20(e.g.%20for%20%2430k%20budget)%0A%20%20%20%20%23%20Ensure%20you%20use%20the%20'results_df'%20from%20the%20forecast%20optimization%0A%20%20%20%20base_results%20%3D%20df_arima_results.loc%5Bdf_arima_results%5B'Budget%20Scenario'%5D%20%3D%3D%2030000%5D%0A%20%20%20%20%23%20We%20need%20the%20DETAILED%20dataframe%2C%20not%20the%20summary.%20%0A%20%20%20%20%23%20Re-run%20one%20optimization%20to%20get%20the%20detail%20if%20needed%3A%0A%20%20%20%20best_model_run%20%3D%20optimize_inventory(pd.concat(%5Btimeseries_18%2C%20arima_forecast%5D)%2C%20cost_df%2C%2030000)%0A%20%20%20%20detailed_plan%20%3D%20best_model_run%5B'results_df'%5D%0A%0A%20%20%20%20%23%202.%20Define%20Scenarios%0A%20%20%20%20%23%20Baseline%3A%20We%20assumed%201.25%2C%20and%20reality%20was%201.25%20(Perfect%20Match)%0A%20%20%20%20profit_baseline%20%3D%20simulate_prescription_impact(detailed_plan%2C%20cost_df%2C%20sigma_plan%3D1.25%2C%20sigma_actual%3D1.25)%0A%0A%20%20%20%20%23%20New%20Scenario%3A%20We%20assumed%201.25%2C%20but%20reality%20changed%20to%200.625%20(Mismatch)%0A%20%20%20%20%23%20This%20simulates%20%22Using%20the%20wrong%20distribution%20for%20the%20PrescriptionDistributor%22%0A%20%20%20%20profit_new_reality%20%3D%20simulate_prescription_impact(detailed_plan%2C%20cost_df%2C%20sigma_plan%3D1.25%2C%20sigma_actual%3D0.625)%0A%0A%20%20%20%20%23%20Optimized%20New%3A%20We%20assumed%200.625%2C%20and%20reality%20was%200.625%20(Optimized)%0A%20%20%20%20%23%20This%20simulates%20%22If%20we%20had%20updated%20our%20model%22%0A%20%20%20%20profit_optimized%20%3D%20simulate_prescription_impact(detailed_plan%2C%20cost_df%2C%20sigma_plan%3D0.625%2C%20sigma_actual%3D0.625)%0A%0A%20%20%20%20%23%203.%20Print%20Results%0A%20%20%20%20print(f%22---%20PART%20(C)%20PRESCRIPTION%20DISTRIBUTION%20IMPACT%20---%22)%0A%20%20%20%20print(f%22Original%20Profit%20(Aggregate%20Model)%3A%20%24%7Bbest_model_run%5B'total_profit'%5D%3A%2C.2f%7D%22)%0A%20%20%20%20print(%22-%22%20*%2050)%0A%20%20%20%20print(f%22Scenario%201%3A%20Distribution%20Match%20(Wide%2FWide)%20%20%20%3A%20%24%7Bprofit_baseline%3A%2C.2f%7D%22)%0A%20%20%20%20print(f%22Scenario%202%3A%20Distribution%20Mismatch%20(Wide%2FNarrow)%3A%20%24%7Bprofit_new_reality%3A%2C.2f%7D%22)%0A%20%20%20%20print(f%22Scenario%203%3A%20Updated%20Model%20(Narrow%2FNarrow)%20%20%20%20%3A%20%24%7Bprofit_optimized%3A%2C.2f%7D%22)%0A%20%20%20%20print(%22-%22%20*%2050)%0A%20%20%20%20print(f%22Loss%20due%20to%20Mismatch%3A%20%24%7Bprofit_baseline%20-%20profit_new_reality%3A%2C.2f%7D%22)%0A%0A%20%20%20%20%23%204.%20Visualize%20the%20Distributions%0A%20%20%20%20x%20%3D%20np.arange(-6%2C%206.25%2C%200.25)%0A%20%20%20%20y1%20%3D%20get_prescription_weights(1.25%2C%20start%3D-6%2C%20end%3D6).values%0A%20%20%20%20y2%20%3D%20get_prescription_weights(0.625%2C%20start%3D-6%2C%20end%3D6).values%0A%0A%20%20%20%20plt.figure(figsize%3D(10%2C%205))%0A%20%20%20%20plt.plot(x%2C%20y1%2C%20label%3D'Original%20(Sigma%3D1.25)'%2C%20color%3D'blue'%2C%20linewidth%3D2)%0A%20%20%20%20plt.plot(x%2C%20y2%2C%20label%3D'New%20(Sigma%3D0.625)'%2C%20color%3D'red'%2C%20linestyle%3D'--'%2C%20linewidth%3D2)%0A%20%20%20%20plt.fill_between(x%2C%20y1%2C%20alpha%3D0.1%2C%20color%3D'blue')%0A%20%20%20%20plt.fill_between(x%2C%20y2%2C%20alpha%3D0.1%2C%20color%3D'red')%0A%20%20%20%20plt.title(%22Prescription%20Demand%20Distribution%20Change%22)%0A%20%20%20%20plt.xlabel(%22Diopters%20(Power)%22)%0A%20%20%20%20plt.ylabel(%22Probability%22)%0A%20%20%20%20plt.legend()%0A%20%20%20%20plt.grid(True%2C%20alpha%3D0.3)%0A%20%20%20%20plt.show()%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "notebook.py",
            "mode": "edit",
            "version": "0.18.4",
            "serverToken": "unused",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": true, "theme": "system"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": false},
            "notebook": null,
            "session": null,
            "runtimeConfig": null,
        };
    </script>
  </body>
</html>
